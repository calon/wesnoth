#textdomain wesnoth-help
# Ability macros to be included in the SingleWML description of a unit.

#define ABILITY_HEALS
    # Canned definition of the heal+4 ability to be included in an [abilities] clause.
    [heals]
        value=4
        id=healing
        affect_allies=yes
        name= _ "heals +4"
        female_name= _ "female^heals +4"
        description=  _ "Allows the unit to heal adjacent allied units at the beginning of our turn.

A unit cared for by this healer may heal up to 4 HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_EXTRA_HEAL
    [heals]
        value=8
        id=healing
        affect_allies=yes
        name= _ "heals +8"
        female_name= _ "female^heals +8"
        description= _ "This unit combines herbal remedies with magic to heal units more quickly than is normally possible on the battlefield.

A unit cared for by this healer may heal up to 8 HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_UNPOISON
    # Canned definition of the cure-poison ability to be included
    # in an [abilities] clause.
    [heals]
        affect_allies=yes
        id=curing
        name= _ "cures"
        female_name= _ "female^cures"
        description= _ "A curer can cure a unit of poison, although that unit will receive no additional healing on the turn it is cured of the poison."
        affect_self=no
        poison=cured
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_CURES
    # Canned definition of the cure ability (which entails heal+8) to be
    # included in an [abilities] clause..
    {ABILITY_UNPOISON}
    {ABILITY_EXTRA_HEAL}
#enddef

#define ABILITY_REGENERATES
    # Canned definition of the Regenerate ability to be included in an [abilities]
    # clause.
    [regenerate]
        value=8
        id=regenerates
        name= _ "regenerates"
        female_name= _ "female^regenerates"
        description= _ "The unit will heal itself 8 HP per turn. If it is poisoned, it will remove the poison instead of healing."
        affect_self=yes
        poison=cured
    [/regenerate]
#enddef

#define ABILITY_STEADFAST
    # Canned definition of the Steadfast ability to be included in an [abilities]
    # clause.
    [resistance]
        id=steadfast
        multiply=2
        max_value=50
        # applies to any type if we leave it out
        #apply_to=blade,pierce,impact,fire,cold,arcane
        [filter_base_value]
            greater_than=0
            less_than=50
        [/filter_base_value]
        name= _ "steadfast"
        female_name= _ "female^steadfast"
        description= _ "This unitâ€™s resistances are doubled, up to a maximum of 50%, when defending. Vulnerabilities are not affected."
        affect_self=yes
        active_on=defense
    [/resistance]
#enddef

#define ABILITY_LEADERSHIP_LEVEL_1
    # Canned definition of the Leadership (level 1) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=leadership
        value=25
        cumulative=no
        name= _ "leadership"
        female_name= _ "female^leadership"
        description= _ "This unit can lead our own units that are next to it, making them fight better.

Adjacent own units of lower level will do more damage in battle. When a unit adjacent to, of a lower level than, and on the same side as a unit with Leadership engages in combat, its attacks do 25% more damage times the difference in their levels."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_LEADERSHIP_LEVEL_2
    # Canned definition of the Leadership (level 2) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=leadership
        value=50
        cumulative=no
        name= _ "leadership"
        female_name= _ "female^leadership"
        description= _ "This unit can lead our own units that are next to it, making them fight better.

Adjacent own units of lower level will do more damage in battle. When a unit adjacent to, of a lower level than, and on the same side as a unit with Leadership engages in combat, its attacks do 25% more damage times the difference in their levels."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=25
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_LEADERSHIP_LEVEL_3
    # Canned definition of the Leadership (level 3) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=leadership
        value=75
        cumulative=no
        name= _ "leadership"
        female_name= _ "female^leadership"
        description= _ "This unit can lead our own units that are next to it, making them fight better.

Adjacent own units of lower level will do more damage in battle. When a unit adjacent to, of a lower level than, and on the same side as a unit with Leadership engages in combat, its attacks do 25% more damage times the difference in their levels."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=50
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=25
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_LEADERSHIP_LEVEL_4
    # Canned definition of the Leadership (level 4) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=leadership
        value=100
        cumulative=no
        name= _ "leadership"
        female_name= _ "female^leadership"
        description= _ "This unit can lead our own units that are next to it, making them fight better.

Adjacent own units of lower level will do more damage in battle. When a unit adjacent to, of a lower level than, and on the same side as a unit with Leadership engages in combat, its attacks do 25% more damage times the difference in their levels."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=75
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=50
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=25
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_LEADERSHIP_LEVEL_5
    # Canned definition of the Leadership (level 5) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=leadership
        value=125
        cumulative=no
        name= _ "leadership"
        female_name= _ "female^leadership"
        description= _ "This unit can lead our own units that are next to it, making them fight better.

Adjacent own units of lower level will do more damage in battle. When a unit adjacent to, of a lower level than, and on the same side as a unit with Leadership engages in combat, its attacks do 25% more damage times the difference in their levels."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=100
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=75
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=50
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=25
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=4
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_LEADERSHIP_LEVEL_6
    # Canned definition of the Leadership (level 5) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=leadership
        value=150
        cumulative=no
        name= _ "leadership"
        female_name= _ "female^leadership"
        description= _ "This unit can lead your own units that are next to it, making them fight better.

Adjacent own units of lower level will do more damage in battle. When a unit adjacent to, of a lower level than, and on the same side as a unit with Leadership engages in combat, its attacks do 25% more damage times the difference in their levels."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=125
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=100
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=75
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=50
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=4
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=leadership
        value=25
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=5
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_SKIRMISHER
    # Canned definition of the Skirmisher ability to be included in an [abilities]
    # clause.
    [skirmisher]
        id=skirmisher
        name= _ "skirmisher"
        female_name= _ "female^skirmisher"
        description= _ "This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control."
        affect_self=yes
    [/skirmisher]
#enddef

#define ABILITY_ILLUMINATES
    # Canned definition of the Illuminates ability to be included in an
    # [abilities] clause.
    [illuminates]
        id=illumination
        value=25
        max_value=25
        cumulative=no
        name= _ "illuminates"
        female_name= _ "female^illuminates"
        description= _ "This unit illuminates the surrounding area, making lawful units fight better, and chaotic units fight worse.

Any units adjacent to this unit will fight as if it were dusk when it is night, and as if it were day when it is dusk."
        affect_self=yes
    [/illuminates]
#enddef

#define ABILITY_TELEPORT
    # Canned definition of the TELEPORT ability to be included in an
    # [abilities] clause.
    [teleport]
        id=teleport
        name= _ "teleport"
        female_name= _ "female^teleport"
        description= _ "This unit may teleport between any two empty villages owned by its side using one of its moves."
        [tunnel]
            id=village_teleport
            [source]
                terrain=*^V*
                owner_side=$teleport_unit.side
                [not]
                    [filter]
                        [not]
                            id=$teleport_unit.id
                        [/not]
                    [/filter]
                [/not]
            [/source]

            [target]
                terrain=*^V*
                owner_side=$teleport_unit.side
                [not]
                    [filter]
                    [/filter]
                [/not]
            [/target]

            [filter]
                ability=teleport
            [/filter]
        [/tunnel]
    [/teleport]
#enddef

#define ABILITY_AMBUSH
    # Canned definition of the Ambush ability to be included in an
    # [abilities] clause.
    [hides]
        id=ambush
        name= _ "ambush"
        female_name= _ "female^ambush"
        name_inactive= _ "ambush"
        female_name_inactive= _ "female^ambush"
        description= _ "This unit can hide in forest, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in forest, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "This unit can hide in forest, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in forest, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter]
            [filter_location]
                terrain=*^F*
            [/filter_location]
        [/filter]
    [/hides]
#enddef

#define ABILITY_NIGHTSTALK
    # Canned definition of the Nightstalk ability to be included in an
    # [abilities] clause.
    [hides]
        id=nightstalk
        name= _ "nightstalk"
        female_name= _ "nightstalk"
        description= _ "The unit becomes invisible during night.

Enemy units cannot see this unit at night, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        name_inactive= _ "nightstalk"
        female_name_inactive= _ "female^nightstalk"
        description_inactive= _ "The unit becomes invisible during night.

Enemy units cannot see this unit at night, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/hides]
#enddef

#define ABILITY_CONCEALMENT
    # Canned definition of the Concealment ability to be included in an
    # [abilities] clause.
    [hides]
        id=concealment
        name= _ "concealment"
        female_name= _ "female^concealment"
        description= _ "This unit can hide in villages (with the exception of water villages), and remain undetected by its enemies, except by those standing next to it.

Enemy units can not see this unit while it is in a village, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        name_inactive= _ "concealment"
        female_name_inactive= _ "female^concealment"
        description_inactive= _ "This unit can hide in villages (with the exception of water villages), and remain undetected by its enemies, except by those standing next to it.

Enemy units can not see this unit while it is in a village, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter]
            [filter_location]
                terrain=*^V*
            [/filter_location]
        [/filter]
    [/hides]
#enddef

#define ABILITY_SUBMERGE
    # Canned definition of the Submerge ability to be included in an
    # [abilities] clause.
    [hides]
        id=submerge
        name= _ "submerge"
        female_name= _ "female^submerge"
        description= _ "This unit can hide in deep water, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in deep water, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        name_inactive= _ "submerge"
        female_name_inactive= _ "female^submerge"
        description_inactive= _ "This unit can hide in deep water, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in deep water, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter]
            [filter_location]
                terrain=Wo*^*
            [/filter_location]
        [/filter]
    [/hides]
#enddef

# wmllint: unbalanced-on
#define ABILITY_FEEDING
    # Canned definition of the Feeding ability to be included in an
    # [abilities] clause.  Note: this is deliberately unbalanced WML,
    # in order to close the abilities clause then insert the event
    # then reopen the abilities clause.
    [dummy]
        id=feeding
        name= _ "feeding"
        female_name= _ "female^feeding"
        description=_ "This unit gains 1 hitpoint added to its maximum whenever it kills a unit, except units that are immune to plague."
    [/dummy]
    # wmlxgettext: [abilities]
[/abilities]
[event]
    id=ability_feeding_die
    name=die
    first_time_only=no

    [filter]
        [not]
            [filter_wml]
                [status]
                    unplagueable="yes"
                [/status]
            [/filter_wml]
        [/not]
    [/filter]

    [filter_second]
        ability=feeding
    [/filter_second]

    [unstore_unit]
        variable=second_unit
        {COLOR_HEAL}
        text= _ "+1 max HP"
        find_vacant=no
    [/unstore_unit]

    [object]
        silent=yes
        duration=forever

        [filter]
            x,y=$x2,$y2
        [/filter]

        [effect]
            apply_to=hitpoints
            increase_total=1
            increase=1
        [/effect]
    [/object]
[/event]
[+abilities]
    # wmlxgettext: [/abilities]
#enddef
# wmllint: unbalanced-off

#weapons specials

#define WEAPON_SPECIAL_BERSERK
    # Canned definition of the Berserk ability to be included in a
    # [specials] clause.
    [berserk]
        id=berserk
        name= _ "berserk"
        description= _ "Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 30 rounds of attacks have occurred."
        value=30
    [/berserk]
#enddef

#define WEAPON_SPECIAL_BACKSTAB
    # Canned definition of the Backstab ability to be included in a
    # [specials] clause.
    [damage]
        id=backstab
        name= _ "backstab"
        description= _ "When used offensively, this attack deals double damage if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
        multiply=2
        backstab=yes
        active_on=offense
    [/damage]
#enddef

#define WEAPON_SPECIAL_PLAGUE_TYPE TYPE
    # Canned definition of the Plague ability to be included in a
    # [specials] clause (with type specifier).
    [plague]
        id=plague({TYPE})
        name= _ "plague"
        description= _ "When a unit is killed by a Plague attack, that unit is replaced with a unit identical to and on the same side as the unit with the Plague attack. This doesnâ€™t work on Undead or units in villages."
        type={TYPE}
    [/plague]
#enddef

#define WEAPON_SPECIAL_PLAGUE
    # Canned definition of the Plague ability to be included in a
    # [specials] clause.
    [plague]
        id=plague
        name= _ "plague"
        description= _ "When a unit is killed by a Plague attack, that unit is replaced with a Walking Corpse on the same side as the unit with the Plague attack. This doesnâ€™t work on Undead or units in villages."
        type=Walking Corpse
    [/plague]
#enddef

#define WEAPON_SPECIAL_SLOW
    # Canned definition of the Slow ability to be included in a
    # [specials] clause.
    [slow]
        id=slow
        name= _ "slows"
        description= _ "This attack slows the target until it ends a turn. Slow halves the damage caused by attacks and the movement cost for a slowed unit is doubled. A unit that is slowed will feature a snail icon in its sidebar information when it is selected."
    [/slow]
#enddef

#define WEAPON_SPECIAL_PETRIFY
    # Canned definition of the Petrify ability to be included in a
    # [specials] clause.
    [petrifies]
        id=petrifies
        name= _ "petrifies"
        description= _ "This attack petrifies the target, turning it to stone. Units that have been petrified may not move or attack."
    [/petrifies]
#enddef

#define WEAPON_SPECIAL_MARKSMAN
    # Canned definition of the Marksman ability to be included in a
    # [specials] clause.
    [chance_to_hit]
        id=marksman
        name= _ "marksman"
        description= _ "When used offensively, this attack always has at least a 60% chance to hit."
        value=60
        cumulative=yes
        active_on=offense
    [/chance_to_hit]
#enddef

#define WEAPON_SPECIAL_MAGICAL
    # Canned definition of the Magical (targeting) ability to be included in a
    # [specials] clause.
    [chance_to_hit]
        id=magical
        name= _ "magical"
        description= _ "This attack always has a 70% chance to hit regardless of the defensive ability of the unit being attacked."
        value=70
        cumulative=no
    [/chance_to_hit]
#enddef

#define WEAPON_SPECIAL_SWARM
    # Canned definition of the Swarm ability to be included in a
    # [specials] clause.
    [swarm]
        id=swarm
        name= _ "swarm"
        description= _ "The number of strikes of this attack decreases when the unit is wounded. The number of strikes is proportional to the percentage of its of maximum HP the unit has. For example a unit with 3/4 of its maximum HP will get 3/4 of the number of strikes."
    [/swarm]
#enddef

#define WEAPON_SPECIAL_CHARGE
    # Canned definition of the Charge ability to be included in a
    # [specials] clause.
    [damage]
        id=charge
        name= _ "charge"
        description= _ "When used offensively, this attack deals double damage to the target. It also causes this unit to take double damage from the targetâ€™s counterattack."
        multiply=2
        apply_to=both
        active_on=offense
    [/damage]
#enddef

#define WEAPON_SPECIAL_DRAIN
    # Canned definition of the Drain ability to be included in a
    # [specials] clause.
    [drains]
        id=drains
        name= _ "drains"
        description= _ "This unit drains health from living units, healing itself for half the amount of damage it deals (rounded down)."
    [/drains]
#enddef

#define WEAPON_SPECIAL_FIRSTSTRIKE
    # Canned definition of the First-strike ability to be included in a
    # [specials] clause.
    [firststrike]
        id=firststrike
        name= _ "first strike"
        description= _ "This unit always strikes first with this attack, even if they are defending."
    [/firststrike]
#enddef

#define WEAPON_SPECIAL_POISON
    # Canned definition of the Poison ability to be included in a
    # [specials] clause.
    [poison]
        id=poison
        name= _ "poison"
        description= _ "This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison can not, of itself, kill a unit."
    [/poison]
#enddef

#define ABILITY_DISTRACT
    [skirmisher]
        id=distract
        name= _ "distract"
        description= _ "Distract: This unit negates enemy Zones of Control around itself for allied units."
        affect_self=yes
        affect_allies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/skirmisher]
#enddef

#define WEAPON_SPECIAL_SHOCK
    # Canned definition of the Shock ability to be included in a
    # [specials] clause.
    [attacks]
        id=shock
        name= _ "shock"
        name_inactive= _ "shock"
        description= _ "Shock: When this attack is used on offense, the opponent will retaliate with one less strike than normally, to a minimum of one strike."
        description_inactive= _ "Shock: When this attack is used on offense, the opponent will retaliate with one less strike than normally, to a minimum of one strike."
        sub=1
        active_on=offense
        apply_to=opponent
        [filter_base_value]
            greater_than=1
        [/filter_base_value]
    [/attacks]
#enddef

#define WEAPON_SPECIAL_STUN
    [damage]
        id=tail_stun
        name= _ "stun"
        description= _ "This attack hits so hard that the defender is dazed and can no longer enforce a zone of control. The effect wears off on the defenderâ€™s next turn."
        multiply=1
    [/damage]
#enddef

#define ABILITY_INITIATIVE
[dummy]
    id=initiative
    name= _ "initiative"
    description= _ "Initiative: Adjacent allies are granted Firststrike with all weapons."
[/dummy]
[/abilities]
    [event]
        name=attack
        first_time_only=no

        [filter]
            [filter_adjacent]
                is_enemy=no
            [/filter_adjacent]
        [/filter]
        
        {FOREACH unit.attack i}
            {VARIABLE unit.attack[$i].specials.firststrike.id "firststrike"}
        {NEXT i}
        
        [unstore_unit]
            variable=unit
        [/unstore_unit]
    [/event]
    [event]
        name=attack
        first_time_only=no

        [filter_second]
            [filter_adjacent]
                is_enemy=no
            [/filter_adjacent]
        [/filter_second]
        
        {FOREACH second_unit.attack i}
            {VARIABLE second_unit.attack[$i].specials.firststrike.id "firststrike"}
        {NEXT i}
        
        [unstore_unit]
            variable=second_unit
        [/unstore_unit]
    [/event]
    [event]
        name=attack_end
        first_time_only=no

        [filter]
            [wml_filter]
                [attack]
                    [specials]
                        [firststrike]
                            id=firststrike
                        [/firststrike]
                    [/specials]
                [/attack]
            [/wml_filter]
        [/filter]
        
        {FOREACH unit.attack i}
            {CLEAR_VARIABLE unit.attack[$i].specials.firststrike}
        {NEXT i}
        
        [unstore_unit]
            variable=unit
        [/unstore_unit]
    [/event]
    [event]
        name=attack_end
        first_time_only=no

        [filter_second]
            [wml_filter]
                [attack]
                    [specials]
                        [firststrike]
                            id=firststrike
                        [/firststrike]
                    [/specials]
                [/attack]
            [/wml_filter]
        [/filter_second]
        
        {FOREACH second_unit.attack i}
            {CLEAR_VARIABLE second_unit.attack[$i].specials.firststrike}
        {NEXT i}
        
        [unstore_unit]
            variable=second_unit
        [/unstore_unit]
    [/event]
[+abilities]
#enddef

#define ABILITY_DELUMINATES
    # definition of the Illuminates ability
    # [abilities] clause.
    [illuminates]
        [filter_self]
            [filter_location]
                [not]
                    time_of_day = chaotic
                [/not]
            [/filter_location]
        [/filter_self]
        id=delumination
        value=-25
        cumulative=no
        name= _ "deluminates"
        description= _ "Deluminates: This unit deluminates the surrounding area, making chaotic units fight better, and lawful units fight worse.

Any units adjacent to this unit will fight as if it were dawn when it is day, and as if it were night when it is dawn."
        affect_self=yes
    [/illuminates]
#enddef

#define ABILITY_DISRUPTS
    [resistance]
        id=disrupts
        name= _ "disrupts"
        description= _ "Disrupts: Enemy units adjacent to this unit will have their resistances halved. Weaknesses are not affected."
        name_inactive= _ "disrupts"
        description_inactive= _ "Disrupts: Enemy units adjacent to this unit will have their resistances halved. Weaknesses are not affected."
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
        [filter_base_value]
            greater_than=0
        [/filter_base_value]
        multiply=0.5
        cumulative=no
        max_value=100
    [/resistance]
#enddef

#TODO: special notes
#define ABILITY_SMALL_PROTECTION
    [resistance]
        id=small protection
        add=10
        max_value=60
        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "protection"
        description= _ "Protection: Adjacent units of this side receive a +10% bonus to all resistances (up to a maximum of 60%)."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/resistance]
#enddef

#TODO: special notes
#define ABILITY_MIDDLE_PROTECTION
    [resistance]
        id=middle protection
        add=20
        max_value=70
        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "protection"
        description= _ "Protection: Adjacent units of this side receive a +20% bonus to all resistances (up to a maximum of 70%)."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/resistance]
#enddef

#TODO: special notes
#define ABILITY_GREAT_PROTECTION
    [resistance]
        id=great protection
        add=30
        max_value=80
        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "protection"
        description= _ "Protection: Adjacent units of this side receive a +30% bonus to all resistances (up to a maximum of 80%)."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/resistance]
#enddef

#define ABILITY_SWAMP_PROWL
    [hides]
        id=swamp_prowl
        name= _ "swamp prowl"
        name_inactive= _ "swamp prowl"
        description= _ "Swamp Prowl: This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Swamp Prowl: This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Chs,Khs,Ss,Ss^Vhs,Ss^Vm
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_FORESTHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Gs^Fp,Gg^Fet,Gs^Ft,Aa^Fpa
            [/filter_location]
        [/filter_self]
        value=3
        id=healing
        name= _ "foresthome"
        description= _ "Foresthome: This unit will regenerate 3 hp when in forest."
        name_inactive= _ "foresthome"
        description_inactive= _ "Foresthome: This unit will regenerate 3 hp when in forest."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_WATERHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Wo,Ww
            [/filter_location]
        [/filter_self]
        value=3
        id=healing
        name= _ "waterhome"
        description= _ "Waterhome: This unit will regenerate 3 hp when in deep or shallow water."
        name_inactive= _ "waterhome"
        description_inactive= _ "Waterhome: This unit will regenerate 3 hp when in deep or shallow water."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_DESERTHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Dd,Ds
            [/filter_location]
        [/filter_self]
        value=3
        id=healing
        name= _ "deserthome"
        description= _ "Deserthome: This unit will regenerate 3 hp when in desert or sand."
        name_inactive= _ "deserthome"
        description_inactive= _ "Deserthome: This unit will regenerate 3 hp when in desert or sand."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_MTNHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Mm
            [/filter_location]
        [/filter_self]
        value=3
        id=healing
        name= _ "mountainhome"
        description= _ "Mountainhome: This unit will regenerate 3 hp when on mountains."
        name_inactive= _ "mountainhome"
        description_inactive= _ "Mountainhome: This unit will regenerate 3 hp when in mountains."
        affect_self=yes
    [/regenerate]
#enddef

# from Era of Magic
#define WEAPON_SPECIAL_CIRCLE
    [chance_to_hit]
        id=circle
        name= _ "always hits"
        description= _ "always hits: This attack always has a 100% chance to hit"
        value=100
        cumulative=no
    [/chance_to_hit]
#enddef

#define WEAPON_SPECIAL_NOCOUNTERATTACK
    [attacks]
        id=nocounter
        name= _ "no counter-attack"
        description= _ "no counter-attack: The opponent has always a 0% chance to hit, when this unit is attacking."
        name_inactive= _ "no counter-attack"
        description_inactive= _ "no counter-attack: The opponent has always a 0% chance to hit, when this unit is attacking."
        value=0
        cumulative=no
        active_on=offense
        apply_to=opponent
    [/attacks]
#enddef

#define ABILITY_MOUNTAINAMBUSH
    [hides]
        id=mountainambush
        name= _ "mountain ambush"
        name_inactive= _ " mountain ambush"
        description= _ "Mountain Ambush: This unit can hide in mountains and hills, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in mountains or hills, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Ambush: This unit can hide in forest, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in mountains or hills, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=At,Hd,Hh,Ds,Ha,Md,Mm,Ms
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef


#define ABILITY_I8_SWAMPAMBUSH
    [hides]
        id=swampambush
        name= _ "swamp ambush"
        name_inactive= _ "swamp ambush"
        description= _ "Swamp Ambush: This unit can hide in swamp, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Ambush: This unit can hide in forest, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Ss
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_I8_WATERAMBUSH
    [hides]
        id=waterambush
        name= _ "water ambush"
        name_inactive= _ "water ambush"
        description= _ "water ambush: This unit can hide in water, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in water, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Ambush: This unit can hide in forest, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in water, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Ww,Wo
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_I8_CAVEAMBUSH
    [hides]
        id=caveambush
        name= _ "cave ambush"
        name_inactive= _ "cave ambush"
        description= _ "Cave Ambush: This unit can hide in cave, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in cave, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Ambush: This unit can hide in forest, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in cave, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Uu,Ur,Uh
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

# from War of Chaos

#define ABILITY_STEALTH
    [hides]
        id=stealth
        name= _ "stealth"
        name_inactive= _ "stealth"
        description= _ "This unit can hide in anywhere, and remain undetected by its enemies.

Enemy units cannot see this unit except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "This unit can hide in anywhere, and remain undetected by its enemies.

Enemy units cannot see this unit except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
    [/hides]
#enddef

#define WEAPON_SPECIAL_UBER_BACKSTAB
    [damage]
        id=uber backstab
        name= _ "uber backstab"
        description= _ "When used offensively, this attack deals triple damage if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
        multiply=3
        backstab=yes
        active_on=offense
    [/damage]
#enddef

#define ABILITY_REGENERATES_OTHER VALUE
    [regenerate]
        value={VALUE}
        id=regenerates {VALUE}
        name= _ "regenerates ("+{VALUE}+_")"
        female_name= _ "female^regenerates ("+{VALUE}+_")"
        description= _ "The unit will heal itself "+{VALUE}+_" HP per turn. If it is poisoned, it will remove the poison instead of healing."
        affect_self=yes
        poison=cured
    [/regenerate]
#enddef

#define ABILITY_HEALS_OTHER VALUE
    [heals]
        value={VALUE}
        id=healing
        affect_allies=yes
	cumulative=yes
        name= _ "heals +"+{VALUE}
        female_name= _ "female^heals +"+{VALUE}
        description= _ "This unit combines herbal remedies with magic to heal units more quickly than is normally possible on the battlefield.

A unit cared for by this healer may heal up to "+{VALUE}+_" HP per turn, or be cured of poisoning."
        affect_self=no
        poison=cured
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_BURNING_AURA POWER
    [heals]
        value=-{POWER}
        id=burning_aura {POWER}
        affect_enemies=yes
        name= _ "burns foes ("+{POWER}+_")"
        female_name= _ "female^burns foes ("+{POWER}+_")"
        description= _ "Allows the unit to damage adjacent enemies at the beginning of your turn for "+{POWER}+_" damage.

This ability ignores any resistances or weaknesses of enemies, so it's very powerful against spirits. It never kills, only leaves 1hp."
        affect_self=no
        affect_allies=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define WEAPON_SPECIAL_DISTANT_ATTACK
    [attacks]
        id=distant attack
        name= _ "distant attack"
        name_inactive= _ "distant attack"
        description= _ "When this attack is used, the enemy will not counter."
        description_inactive= _ "When this attack is used, the enemy will not counter."
        value=0
        apply_to=opponent
	active_on=offense
    [/attacks]
#enddef

#define WEAPON_SPECIAL_HIT_AND_RUN
    [dummy]
        id=hit and run
        name= _ "hit and run"
        description= _ "When this attack is used, the unit regains half of its max MP."
    [/dummy]
#enddef

#define ABILITY_THORNS
    [dummy]
        id=thorns
        name= _ "thorns"
        description= _ "Any unit that attacks this unit in melee suffers two points of piercing damage. Unlike reflect, it can kill."
    [/dummy]
#enddef

#define ABILITY_MOCKERY
    [dummy]
        id=mockery
        name= _ "mockery"
        description= _ "When an attack against this unit misses, he/she heals 2 HP."
    [/dummy]
#enddef
#define ABILITY_MURDERLUST
    [dummy]
        id=murderlust
        name= _ "murderlust"
        description= _ "When this unit kills another unit, he/she heals 8 HP."
    [/dummy]
#enddef

#define ABILITY_KILLHUNGER
    [dummy]
        id=killhunger
        name= _ "killhunger"
        description= _ "When this unit kills another unit, it heals 4 HP, and is ridden of poison and slow."
    [/dummy]
#enddef

#define ABILITY_EVISCERATION
    [dummy]
        id=evisceration
        name= _ "evisceration"
        description= _ "When this unit kills another unit, nearby allies heal 10 HP, and are ridden of poison and slow."
    [/dummy]
#enddef
#define ABILITY_GREATER_EVISCERATION
    [dummy]
        id=greater evisceration
        name= _ "greater evisceration"
        description= _ "When this unit kills another unit, nearby allies heal 16 HP, and are ridden of poison and slow."
    [/dummy]
#enddef
#define ABILITY_REGROWING
    [dummy]
        id=regrowing
        name= _ "regrowing"
        description= _ "When this unit begins combat, offensively or defensively, it heals an amount of hitpoints equal to two times their level."
    [/dummy]
#enddef

#define ABILITY_STEALS
    [dummy]
        id=steals
        name= _ "steals"
        description= _ "When this unit hits an enemy with a melee attack, it has a chance to earn some gold."
    [/dummy]
#enddef
#define ABILITY_TAX_COLLECTOR
    [dummy]
        id=tax collector
        name= _ "tax collector"
        description= _ "When this unit hits an enemy, it has a chance to lose of its side's gold."
    [/dummy]
#enddef

#define ABILITY_IMMUNE_TO_SLOW
    [dummy]
        id=resistant to slow
        name= _ "resistant to slow"
        description= _ "This unit has so much life energy in it, that it will break through any slowing effect almost instantly."
    [/dummy]
#enddef

#define WEAPON_SPECIAL_EXPLOSIVE_SLOW
    [damage]
        id=explosive slow
        name= _ "explosive slow"
        description= _ "When this attack is used, all enemies adjacent to a target are slowed."
    [/damage]
#enddef

#define ABILITY_PENETRATE
    [dummy]
        id=penetrate
        name= _ "penetrates"
        female_name= _ "female^penetrates"
        description= _ "This unit gains 1 movement after attacking, allowing it to slowly progress through ranks of enemies if it can survive their attacks."
    [/dummy]
#enddef
#define WEAPON_SPECIAL_INFECT
    [poison]
        id=infect
        name= _ "infect"
        description= _ "The target of this weapon specials becomes poisoned in a special way, so that if it dies from the poison, it becomes a Walking Corpse."
    [/poison]
#enddef
#define WEAPON_SPECIAL_GREATER_INFECT
    [poison]
        id=greater infect
        name= _ "greater infect"
        description= _ "The target of this weapon specials becomes poisoned in a special way, so that if it dies from the poison, it becomes a Soulless."
    [/poison]
#enddef

#define WEAPON_SPECIAL_MIND_RAID
    [dummy]
        id=mind raid
        name= _ "mind raid"
        description= _ "This weapon special steals 1 experience from the opponent, increasing the user's experience. It does not work if the target has no experience."
    [/dummy]
#enddef

#define ABILITY_PENETRATE_LEADERSHIP
    [dummy]
        id=push
        name= _ "push"
        description= _ "When an ally standing next to this unit finishes attacking, it gains one movement point."
    [/dummy]
#enddef

#define ABILITY_FROM_THE_ASHES
    [dummy]
        id=from the ashes
        name= _ "from the ashes"
        description= _ "If this unit is attacked and its hitpoints drop bellow 20, it heals 40 hitpoints and deals 40 fire damage to all nearby foes. This ability can be used only once per 10 turns."
    [/dummy]
#enddef

#define WEAPON_SPECIAL_SHOCKWAVE
    [slow]
        id=shockwave
        name= _ "shockwave"
        description= _ "This attack is so strong that it slows the target, and creates a shock wave that knocks all enemies adjacent to the target 1 hex away from it, and causes them to take 8 impact damage. When used defensively, it only slows the attacker."
    [/slow]
#enddef

#define WEAPON_SPECIAL_KAMIKAZE_SPRINT
    [damage]
        id=kamikaze sprint
        name= _ "kamikaze sprint"
        description= _ "If this attack hits offensively, the attacker takes the damage of all the opponent's attacks. Then, the enemy behind the target takes a half of this attack's damage, the enemy behind him takes a quarter of the initial damage etc, until there are no more enemies in the row, and the attacker will appear there."
    [/damage]
#enddef

#define WEAPON_SPECIAL_DISINTEGRATE
    [damage]
        id=disintegrate
        name= _ "disintegrate"
        description= _ "Every blow with this weapon has a 2% chance to kill an enemy without any checks."
    [/damage]
#enddef

#define WEAPON_SPECIAL_SOUL_EXTRACTION
    [damage]
        id=soul extraction
        name= _ "soul extraction"
        description= _ "Every blow with this attack has a 1% chance to kill an enemy, summoning a Ghost in the process."
    [/damage]
#enddef

#define ABILITY_NORTHFROST_AURA
    [dummy]
        id=northfrost aura
        name= _ "northfrost aura"
        female_name= _ "female^northfrost aura"
        description= _ "All enemies in the range of two hexes from this unit will be slowed at the beginning of their turn."
    [/dummy]
#enddef


